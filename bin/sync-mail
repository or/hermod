#!/bin/bash

export PATH=/usr/local/bin:$PATH
script_path=$(readlink "$0")
if [ -z "$script_path" ]; then
    script_path="$0"
fi

cd "$(dirname "$script_path")"

function fail {
    msg=$1
    if [ -z "$msg" ]; then
        icon = ":warning: failed"
    fi
    echo "$msg"
    echo "~~~"
    exit 0
}

echo "archiving mail..."
echo "~~~"
./notmuch-archive >/dev/null 2>&1

echo "syncing..."
echo "~~~"
offlineimap >> /tmp/sync-mail.log 2>&1 || fail
./notmuch-poll
